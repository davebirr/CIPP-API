openapi: 3.0.3
info:
  title: CIPP API
  version: 1.0.0
  description: API for retrieving Microsoft 365 service health summaries for all authorized tenants.
servers:
  - url: https://REPLACE_ME.azurewebsites.net
paths:
  /api/GetCippAlerts:
    get:
      summary: Get CIPP alerts
      description: |
        Returns a list of CIPP alerts, including system warnings, version status, and recent alert records.
        
        - Checks CIPP frontend and API version status
        - Warns about incomplete setup or superadmin usage
        - Returns up to 10 recent alerts from the CippAlerts table
      operationId: GetCippAlerts
      tags: [CIPP]
      parameters:
        - name: localversion
          in: query
          description: The local CIPP frontend version to check for updates.
      responses:
        '200':
          description: A list of CIPP alerts and system warnings.
        '400':
          description: Bad request.
        '500':
          description: Internal server error.
      security: []
  /api/ExecAddAlert:
    post:
      summary: Trigger or configure a CIPP alert
      description: |
        Triggers a CIPP alert via email, webhook, PSA, or log, or updates alert notification configuration.
        
        - Can send alerts immediately or update notification settings
        - Accepts a JSON body with alert details and options
      operationId: ExecAddAlert
      tags: [CIPP]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                sendEmailNow:
                  type: boolean
                  description: Send alert via email immediately
                sendWebhookNow:
                  type: boolean
                  description: Send alert via webhook immediately
                sendPsaNow:
                  type: boolean
                  description: Send alert via PSA immediately
                writeLog:
                  type: boolean
                  description: Write alert to log
                Severity:
                  type: string
                  description: Alert severity
                text:
                  type: string
                  description: Alert message content
                email:
                  type: string
                  description: Email address for notifications
                webhook:
                  type: string
                  description: Webhook URL for notifications
                onePerTenant:
                  type: boolean
                  description: Only send one alert per tenant
                logsToInclude:
                  type: string
                  description: Logs to include in alert
      responses:
        '200':
          description: Alert triggered or configuration updated.
        '400':
          description: Bad request.
        '500':
          description: Internal server error.
      security: []
  /api/ExecAzBobbyTables:
    post:
      summary: Execute Azure Table operations (SuperAdmin)
      description: |
        Allows SuperAdmin to interact with Azure Tables for advanced integrations. Only specific functions are allowed.
      operationId: ExecAzBobbyTables
      tags: [CIPP, SuperAdmin]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                FunctionName:
                  type: string
                  description: Name of the allowed Azure Table function to execute
                Parameters:
                  type: object
                  description: Parameters for the function
                TableName:
                  type: string
                  description: Table name (if required)
      responses:
        '200':
          description: Function executed successfully.
        '404':
          description: Function not found or not allowed.
        '500':
          description: Internal server error.
      security: []
  /api/ExecCippFunction:
    post:
      summary: Execute a CIPPCore function (SuperAdmin)
      description: |
        Allows SuperAdmin to execute a CIPPCore function by name, with parameters. Some functions are blocked for security.
      operationId: ExecCippFunction
      tags: [CIPP, SuperAdmin]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                FunctionName:
                  type: string
                  description: Name of the CIPPCore function to execute
                Parameters:
                  type: object
                  description: Parameters for the function
      responses:
        '200':
          description: Function executed successfully.
        '404':
          description: Function not found or not allowed.
        '500':
          description: Internal server error.
      security: []
  /api/ExecCPVRefresh:
    post:
      summary: Trigger CPV refresh for all tenants
      description: |
        Triggers a refresh of CPV (permissions/validation) for all tenants. Returns orchestration instance ID.
      operationId: ExecCPVRefresh
      tags: [CIPP]
      responses:
        '200':
          description: CPV refresh triggered.
        '500':
          description: Internal server error.
      security: []
  /api/ExecDurableFunctions:
    get:
      summary: Query or manage Durable Functions orchestrators
      description: |
        Provides information and management for Durable Functions orchestrators, including listing, stats, and purging.
      operationId: ExecDurableFunctions
      tags: [CIPP]
      parameters:
        - name: Action
          in: query
          description: Action to perform (ListOrchestrators, ListOrchestratorHistory, ListStats, ResetDurables, PurgeOrchestrators)
          required: true
          schema:
            type: string
        - name: PartitionKey
          in: query
          description: Partition key for orchestrator history (if applicable)
          required: false
          schema:
            type: string
      responses:
        '200':
          description: Durable Functions info or action result.
        '500':
          description: Internal server error.
      security: []
  /api/ExecEditTemplate:
    post:
      summary: Edit or save a template
      description: |
        Edits or saves a template (e.g., Intune, TransportRule) in the CIPP system.
      operationId: ExecEditTemplate
      tags: [CIPP]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                guid:
                  type: string
                  description: Template GUID
                Type:
                  type: string
                  description: Template type (e.g., IntuneTemplate)
                displayName:
                  type: string
                  description: Display name
                description:
                  type: string
                  description: Description
      responses:
        '200':
          description: Template saved or edited.
        '500':
          description: Editing template failed.
      security: []
  /api/ExecGeoIPLookup:
    get:
      summary: Lookup GeoIP information
      description: |
        Returns GeoIP location information for a given IP address.
      operationId: ExecGeoIPLookup
      tags: [CIPP]
      parameters:
        - name: IP
          in: query
          description: IP address to look up
          required: true
          schema:
            type: string
      responses:
        '200':
          description: GeoIP location info.
        '400':
          description: IP address is required.
        '500':
          description: Internal server error.
      security: []
  /api/ExecGraphRequest:
    get:
      summary: Execute a Microsoft Graph request
      description: |
        Executes a Microsoft Graph API request for a specified endpoint and tenant.
      operationId: ExecGraphRequest
      tags: [CIPP]
      parameters:
        - name: Endpoint
          in: query
          description: Microsoft Graph endpoint (relative path)
          required: true
          schema:
            type: string
        - name: TenantFilter
          in: query
          description: Tenant ID or 'AllTenants'
          required: false
          schema:
            type: string
        - name: DisablePagination
          in: query
          description: Disable pagination
          required: false
          schema:
            type: boolean
      responses:
        '200':
          description: Graph API response.
        '403':
          description: Forbidden or error.
        '500':
          description: Internal server error.
      security: []
  /api/ExecListBackup:
    get:
      summary: List CIPP backups
      description: |
        Lists available CIPP backups, optionally filtered by type, tenant, or name.
      operationId: ExecListBackup
      tags: [CIPP]
      parameters:
        - name: Type
          in: query
          description: Backup type
          required: false
          schema:
            type: string
        - name: tenantFilter
          in: query
          description: Tenant filter
          required: false
          schema:
            type: string
        - name: NameOnly
          in: query
          description: Return only backup names
          required: false
          schema:
            type: boolean
        - name: BackupName
          in: query
          description: Filter by backup name
          required: false
          schema:
            type: string
      responses:
        '200':
          description: List of backups.
        '500':
          description: Internal server error.
      security: []
  /api/ExecPartnerWebhook:
    post:
      summary: Manage Partner Webhook subscriptions
      description: |
        Manages Microsoft Partner Center webhook subscriptions (list, create, send test, etc.).
      operationId: ExecPartnerWebhook
      tags: [CIPP]
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                Action:
                  type: string
                  description: Action to perform (ListEventTypes, ListSubscription, CreateSubscription, SendTest, ValidateTest)
                EventType:
                  type: object
                  description: Event type for subscription
      responses:
        '200':
          description: Webhook action result.
        '500':
          description: Internal server error.
      security: []
  /api/ExecServicePrincipals:
    get:
      summary: Manage or query service principals
      description: |
        Creates or queries Azure AD service principals. Supports lookup by AppId or Id, or creation.
      operationId: ExecServicePrincipals
      tags: [CIPP]
      parameters:
        - name: Action
          in: query
          description: Action to perform (Create, Default)
          required: false
          schema:
            type: string
        - name: AppId
          in: query
          description: Application ID
          required: false
          schema:
            type: string
        - name: Id
          in: query
          description: Service principal object ID
          required: false
          schema:
            type: string
      responses:
        '200':
          description: Service principal info or creation result.
        '500':
          description: Internal server error.
      security: []
  /api/ExecSetCIPPAutoBackup:
    post:
      summary: Enable or schedule automatic CIPP backup
      description: |
        Enables or schedules automatic CIPP backup as a recurring task.
      operationId: ExecSetCIPPAutoBackup
      tags: [CIPP]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                Enabled:
                  type: boolean
                  description: Enable automatic backup
      responses:
        '200':
          description: Scheduled task created.
        '500':
          description: Internal server error.
      security: []
  /api/GetVersion:
    get:
      summary: Get CIPP API version
      description: |
        Returns the current version of the CIPP API and version status.
      operationId: GetVersion
      tags: [CIPP]
      parameters:
        - name: LocalVersion
          in: query
          description: Local version to compare
          required: false
          schema:
            type: string
      responses:
        '200':
          description: Version info.
        '500':
          description: Internal server error.
      security: []
  /api/ListApiTest:
    post:
      summary: Test API endpoint
      description: |
        Returns the received request as JSON. Used for testing API connectivity and request structure.
      operationId: ListApiTest
      tags: [CIPP]
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
      responses:
        '200':
          description: Echoed request JSON.
        '500':
          description: Internal server error.
      security: []
  /api/ListDirectoryObjects:
    post:
      summary: Get Azure AD directory objects by IDs
      description: |
        Retrieves Azure AD directory objects by their IDs using Microsoft Graph.
      operationId: ListDirectoryObjects
      tags: [CIPP]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                tenantFilter:
                  type: string
                  description: Tenant ID
                asApp:
                  type: boolean
                  description: Use application permissions
                ids:
                  type: array
                  items:
                    type: string
                  description: List of object IDs
                $select:
                  type: string
                  description: Properties to select
      responses:
        '200':
          description: Directory objects info.
        '400':
          description: Bad request.
        '500':
          description: Internal server error.
      security: []
  /api/ListEmptyResults:
    get:
      summary: Return an empty result
      description: |
        Returns an empty array. Used for testing or placeholder purposes.
      operationId: ListEmptyResults
      tags: [CIPP]
      responses:
        '200':
          description: Empty array.
      security: []
  /api/ListExtensionCacheData:
    get:
      summary: List extension cache data
      description: |
        Lists extension cache data for a tenant, optionally filtered by data types.
      operationId: ListExtensionCacheData
      tags: [CIPP]
      parameters:
        - name: tenantFilter
          in: query
          description: Tenant ID
          required: false
          schema:
            type: string
        - name: dataTypes
          in: query
          description: Comma-separated list of data types to include
          required: false
          schema:
            type: string
      responses:
        '200':
          description: Extension cache data.
        '500':
          description: Internal server error.
      security: []
  /api/ListGraphBulkRequest:
    post:
      summary: Execute Microsoft Graph bulk request
      description: |
        Executes a Microsoft Graph bulk request for multiple endpoints in a single call.
      operationId: ListGraphBulkRequest
      tags: [CIPP]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                tenantFilter:
                  type: string
                  description: Tenant ID
                asApp:
                  type: boolean
                  description: Use application permissions
                requests:
                  type: array
                  items:
                    type: object
                    properties:
                      id:
                        type: string
                      url:
                        type: string
                      method:
                        type: string
                  description: List of Graph requests
                noPaginateIds:
                  type: array
                  items:
                    type: string
                  description: IDs for which to disable pagination
      responses:
        '200':
          description: Bulk request results.
        '400':
          description: No requests found in the body.
        '500':
          description: Internal server error.
      security: []
  /api/ListGraphRequest:
    get:
      summary: Execute Microsoft Graph request (advanced)
      description: |
        Executes a Microsoft Graph request with advanced filtering, pagination, and options.
      operationId: ListGraphRequest
      tags: [CIPP]
      parameters:
        - name: Endpoint
          in: query
          description: Microsoft Graph endpoint (relative path)
          required: true
          schema:
            type: string
        - name: TenantFilter
          in: query
          description: Tenant ID
          required: false
          schema:
            type: string
        - name: $filter
          in: query
          description: OData filter
          required: false
          schema:
            type: string
        - name: $select
          in: query
          description: OData select
          required: false
          schema:
            type: string
        - name: $expand
          in: query
          description: OData expand
          required: false
          schema:
            type: string
        - name: $top
          in: query
          description: OData top
          required: false
          schema:
            type: integer
        - name: $count
          in: query
          description: OData count
          required: false
          schema:
            type: boolean
        - name: $orderby
          in: query
          description: OData orderby
          required: false
          schema:
            type: string
        - name: $search
          in: query
          description: OData search
          required: false
          schema:
            type: string
        - name: format
          in: query
          description: Response format
          required: false
          schema:
            type: string
      responses:
        '200':
          description: Graph request results.
        '500':
          description: Internal server error.
      security: []
  /api/PublicPing:
    get:
      summary: Public ping endpoint
      description: |
        Returns a simple pong response with timestamp and cold start info. Used for health checks.
      operationId: PublicPing
      tags: [CIPP]
      responses:
        '200':
          description: Pong response.
      security: []
components:
  schemas:
    ServiceHealthSummary:
      type: object
      properties:
        TenantName:
          type: string
          description: The display name of the tenant.
        TenantID:
          type: string
          description: The unique identifier of the tenant.
        AdvisoryCount:
          type: integer
          description: Number of ongoing advisories.
        IncidentCount:
          type: integer
          description: Number of ongoing incidents.
        HealthIssueDetails:
          type: array
          description: List of ongoing health issues.
          items:
            type: object # Optionally, define a HealthIssueDetail schema here
